<extend name="Base/common"/>

<block name="header">
    <header class="jumbotron subhead" id="overview">
        <div class="container">
            <h2>源自相同起点，演绎不同精彩！</h2>
            <p class="lead"></p>
        </div>
    </header>
</block>
<block name="side">

</block>     

<block name="style">
<link href="__STATIC__/lightbox/css/lightbox.min.css" rel="stylesheet">
<link rel="stylesheet" href="__STATIC__/prettyPhoto/css/prettyPhoto.css" type="text/css" media="screen" charset="utf-8" />
<style>
.thumbnails li:hover{border-color:blue;}
.popover{max-width:600px;};

.comment-body a{cursor:pointer;}
.dian-hui a{padding:0 5px;}

</style>
</block>
<block name="body">
   <div>
   	<ul class="breadcrumb">
	  <li><a href="{:U('Index/index')}">首页</a> <span class="divider">/</span></li>
	  <li><a href="{:U('Album/index')}">相册</a> <span class="divider">/</span></li>
	  <li class="active">{$album.name}</li>
	</ul>
   </div>

   <div style="margin:0 0 20px 0 ;">
     <div class="row-fluid">
	    <div class="span6">
	    	  <div style="float:left;">
	    	  <img data-src="holder.js/260x180"  alt="260x180" src="/Uploads{$album.fengmian|default='/none.png'}"  style="width: 100px; height: 100px;">            	         
	    	  </div>  
	    	  <div style="float:left;margin:0 0 0 10px;">

	    	   <h4>{$album.name}</h4>	    	    
	    	   <p>{$album.info}</p>
	    	   <a class="btn btn-primary" href="{:U('album/upload',array('aid'=>$album['id']))}">上传照片</a>
		       <button class="btn btn-info">批量管理</button>
		       <div class="btn-group hide-div" >
					  <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">更多			   
					    <span class="caret"></span>
					  </a>
					  <ul class="dropdown-menu">			   
	                  <li><a href="{:U('album/edit',array('id'=>$album['id']))}">编辑</a></li>
			   </div>  
	    	  </div>         
             
	     
	    </div>
	    <div class="span3 offset3" style=" margin-top: 35px;">
	    <div style="float:right; text-align:right;">
	    			<div>照片数：{$pic_count}</div>
	                <i class="icon-thumbs-up"></i>12
	                <i class="icon-comment"></i>{$comments_count}
	                <p>创建于：{$album.addtime|date='Y-m-d',###}</p>
	    </div>
	    </div>
	  </div>
   </div>
	  
	
	<div class="row-fluid" id='layer-photos-demo'>
	
            <ul class="thumbnails">
            <volist name="pic" id="var" mod="4" >
              <li class="span3">
                <div class="thumbnail">
                 <a href="/Uploads{$var.path}" rel="prettyPhoto[pp_gal]">
                  <img data-src="holder.js/260x180" data-lightbox="image-box-set" data-title="My caption" alt="260x180" src="/Uploads{$var.path}"  style="width: 260px; height: 180px;">
                 </a>
                <div class="caption" style="font-size:10px;">
	                <i class="icon-thumbs-up"></i>12
	                <a class="example" href="javascript:;" data-toggle="popover" data-placement="bottom" data-content='<form style="margin:0px;" class="form-inline"><img  class="img-rounded" style="position:absolute;" src="/Uploads/album/20160509/57302d4d014c4.jpg" width="25" height="25" />&nbsp;<textarea type="text"  style="width:200px;margin:0 8px 0 30px;" class="input-small fast-comment" placeholder="写点什么吧" rows="1"></textarea> <div style="float:right;"> <button type="submit" class="btn">发表</button></div></form>' title="" data-original-title=""><i class="icon-comment"></i></a>100
	                <div class="btn-group hide-div dropdown" >
					  <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">			   
					    <span class="caret"></span>
					  </a>
					  <ul class="dropdown-menu">			   
	                  <li><a href="#" class='shift-ab'>移动</a></li>
	                  <li><a href="#">编辑</a></li>
	                  <li><a href="{:U('album/picDetail',array('pid'=>$var['pid'],'aid'=>$album['id']))}" class="more-comment">更多评论</a></li>
	                  <li class="divider"></li>
	                  <li><a href="{:U('album/setFengmian',array('id'=>$var['pid'],'aid'=>$album['id']))}">设置为封面</a></li>             
					  </ul>
				 </div>  	                         
					<div style="float:right;">
					<span>{$var.addtime|date='Y-m-d',###}</span>
					</div>             
                </div>
                </div>              
              </li>
              <eq name="mod" value="3">
              </ul><ul class="thumbnails">
              </eq>
             </volist>
     
            </ul>
            
                     
            <div class="pagination pagination-centered">
			  <ul>
			    {$pagebar}
			  </ul>
			</div>
          </div>
          
          <div class="comment" style="padding:20px 0px;">
	          <div class='row-fluid'>
		          <div class="span6" style="text-algin:left;"><h4>{$comments_count}条评论，{$canyu}人参与。</h4></div>
		          <div class="span6" style="margin-top:10px;"><div style="float:right;"><i class="fa fa-star fa-lg"></i></div></div>

	          </div>
	          
	          <div class='comment-content'>
	             <div style="float:left;width:7%;"><img  class="img-rounded"  src="/Uploads/album/20160509/57302d4d014c4.jpg" width="45" height="45" /></div>
	             <div style="float:right; width:93%;">
	             <input type="hidden" name="albumid" value="{$album.id}" />
	                  <div><textarea type="text" style="width:99%;" class="comment-text" id="comment-text" placeholder="写点什么吧..." rows="5"></textarea></div>                 
	                  <div style='float:left;'><span class="emotion"><i class="fa fa-smile-o fa-lg"></i></span>&nbsp;</div>
	                  <div style="float:right;"><font class='comm'>0</font>/140 &nbsp;<button class="btn btn-primary submit-comment">发表</button></div>
	                  <div style="clear:both;"></div>
	             </div>	             
	             <div style="clear:both;"></div>
	          </div>
	          
	          <div class="dropdown" style="margin:10px 0;border-bottom:1px solid #dedede;">
			    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
			               最新评论
			        <b class="caret"></b>
			      </a>
			    <ul class="dropdown-menu">
			     <li><a href="#">最早评论</a></li>
			     <li><a href="#">最热评论</a></li>
			    </ul>
			  </div>
			  
	   <div class='comment-body'>
	         <volist name="comments" id="com">
	          <div class='row-fluid' style="padding:10px 0px;border-top: 1px dotted #ccc;">
			    <div style="float:left;width:7%;"><img  class="img-rounded"  src="/Public/Home/images/noone.jpg" width="45" height="45" /></div>
	             <div style="float:right; width:93%;">
	                   <div style=" word-wrap: break-word; word-break: break-all;margin-bottom: 10px;">
	                                         <a href="javascript:;">{$com.username}</a>:{$com.comment|ubbReplace=###}
	                   </div>
	                   <if condition="$com.sub != ''">
	                    <div style="border:1px solid #dedede;border-radius:4px;padding:8px 20px; margin:0px 40px;">
	                     <a href="javascript:;">{$com.sub.username}</a>:{$com.sub.comment|ubbReplace=###}
	                   </div>
	                   </if>
                  
	                <div class="shi-dian-hui">
	                   <div style='float:left;'><font style="font-size:5px;color:#aeaeae;">{$com.addtime|date='Y年m月d日',###}</font></div>
	                   <div style="float:right;" class="dian-hui" >
	                     <if condition="$com.add_uid == session('user_auth.uid')" ><a class='delete-hui' style="display:none;" href="javascript:;" data-id="{$com.id}" >删除</a></if>
	                     <a href="javascript:;"  data-id= "{$com.id}" <if condition="$com.isZan == 1"> class="zan quxiao" style="color:red;"<else />class="zan dianzan"</if> ><i class="fa fa-thumbs-o-up">(<span>{$com.zan}</span>)</i></a>|<a href="javascript:;" class="show-huifu" data-target="#demo{$com.id}">回复</a>	                        	                        
	                   </div>
	                   <div style="clear:both;"></div>
	                </div>
	             </div>	
             	   <div id="demo{$com.id}" class="coll comment-content" style="display:none;" >
			        <div style="padding:10px 0; width:80%;float:right;">
			         <form action="{:U('album/addHuifu')}" method="post">
	                  <input type="hidden" name="albumid" value="{$album.id}" />
	                  <input type="hidden" name="commentid" value="{$com.id}" />
	                  <div><textarea type="text" style="width:98%;" name='con' class="comment-text" id="comment-text" placeholder="写点什么吧..." rows="2"></textarea></div>                 
	                  <div style='float:left;'><span class="emotion"><i class="fa fa-smile-o fa-lg"></i></span>&nbsp;</div>
	                  <div style="float:right;"><font class='comm'>0</font>/140 &nbsp;<input type='submit' class="btn btn-primary" value="发表"></div>
	                 
	                  <div style="clear:both;"></div>
	                  </form>
	                 </div>            
	             </div>       
			  </div>

	         </volist>
 
			  
		</div>
			  <a class="btn load-more" style="width:100%;" data-page="2" ><i class="fa fa-angle-double-down"></i>加载更多评论</a>
        </div>
 
          
	</div>
</block>

<block name="script">

<script src="__STATIC__/prettyPhoto/js/jquery.prettyPhoto.js"></script>
<script src="__STATIC__/bootstrap-dropdown-hover-master/dist/jquery.bootstrap-dropdown-hover.min.js"></script>
<script src="__STATIC__/jQuery-qqFace/js/jquery-browser.js"></script>
<script src="__STATIC__/jQuery-qqFace/js/jquery.qqFace.js"></script>
<script src="__STATIC__/style.js"></script>
<script>
$(function(){
	
	//发布
	$('.submit-comment').click(function(){
		
		var con = $('.comment-text').val();
		var aid = $('input[name=albumid]').val();

		if(con == ''){
			layer.alert('评论内容不能为空');
			return false;
		}
		if(con.length > 140){
			layer.alert('评论内容长度超过限制');
			return false;
		}
	
           $.post('{:U("album/addComment")}',{'aid':aid,'con':con},function(data){
			if(data.status == 1){
				layer.alert('提交成功',function(){
					window.location.reload();
				});
				
			}else{
				layer.alert(data.msg);
			}
		},'json'); 
		
	});
	
	$('.emotion').qqFace({ 
		id : 'facebox',
        assign:'comment-text', //给输入框赋值 
        path:'__STATIC__/jQuery-qqFace/arclist/'    //表情图片存放的路径 
    }); 
	
	//更多评论
/* 	$('.more-comment').click(function(){
		var h = $(window).width();
		h = h * 0.8;
		var htm = '<div class="" style="margin:10px 0;"> <div style="float:left;"><img  class="img-rounded"  src="/Uploads/album/20160509/57302d4d014c4.jpg" width="45" height="45" /></div>'+
		     '<div style="float:right; width:93%;"><iframe><div>asdf</div></iframe>'+
                '<div>用户名<font style="color:#aeaeae;font-size:5px;">&nbsp;·&nbsp;20min</font></div>'+
                 '<div>评论内容</div> <div><a href="#"><i class="fa fa-hand-rock-o">顶</i></a><a href="#"><i class="fa fa-commenting-o"></i></a></div>'+
            '</div><div style="clear:both;"></div></div>';
		//自定页
		layer.open({
		  type: 1,
		  title:'更多评论',
		  skin: 'layui-layer-demo', //样式类名
		  closeBtn: 1, //不显示关闭按钮
		  shift: 2,
		  shadeClose: true, //开启遮罩关闭
		  area: 'auto',
		  maxWidth:h,
		  content: '<div style="width:'+h+'px; min-height:400px;"><div style="float:left; margin:10px;"><img  class="img-rounded"  src="/Uploads/album/20160509/57302d4d014c4.jpg" width="300"  /></div><div style="float:right;width:60%;">'+htm+htm+htm+'</div><div style="clear:both;"></div></div>'
		});
	}); */
	
	$("a[rel^='prettyPhoto']").prettyPhoto({
		animation_speed:'fast',
		theme:'facebook',
		social_tools:'<a href="{:U('album/picDetail',array('pid'=>$var['pid'],'aid'=>$album['id']))}" class="more-comment">更多评论</a>',
	});
	
	$('.shift-ab').click(function(){
		layer.alert(123);
	});
	
	$('body').on('blur','.comment-text',function(){
		$('.example').popover('hide')
		/* alert($(this).val().split("\n").length+'.'+$(this).val()); */
	});
	
	$('.example').popover({
		'html':true,
	});
	
/* 	 lightbox.option({
		 'alwaysShowNavOnTouchDevices':true,
	      'resizeDuration': 200,
	      'wrapAround': true,
	      'disableScrolling':true,
	    })  */
	    
});
</script>
</block>